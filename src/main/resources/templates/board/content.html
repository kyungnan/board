<!DOCTYPE html SYSTEM "http://www.thymeleaf.org/dtd/xhtml1-strict-thymeleaf-spring4-4.dtd">
<html lang="ko" xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <link rel="stylesheet" type="text/css" th:href="@{/css/style.css}">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js" integrity="sha512-894YE6QWD5I59HgZOGReFYm4dnWc1Qt5NtvYSaNcOP+u1T9qYdvdihz0PPSiiqn/+/3e7Jo4EaG7TubfWGUrMQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script src="/js/board.js"></script>
</head>

<body>

    <div th:insert="header.html" id="header"></div>

    <div id="container">
        <!-- 게시글 상세보기 -->
        <table class="table table-bordered border-primary">
            <tr>
                <td colspan="3"><div th:text="${findPost.subject}"></div></td>
            </tr>

            <tr>
                <td>작성자: <span th:text="${findPost.writer}"></span></td>
                <td>작성일: <span th:text="${#calendars.format(findPost.regdate, 'yyyy-MM-dd HH:mm')}"></span></td>
                <td>조회수: <span th:text="${findPost.count}"></span></td>
            </tr>

            <!--첨부파일 리스트-->
            <tr>
                <td colspan="3">
                    <div th:if="${!fileList.isEmpty()}" class="p-2 border ml-auto mb-5">
                        <span>첨부파일: </span>
                        <div th:each="file : ${fileList}">
                            <ul>
                                <li id="attach_list" class="d-flex justify-content-between">
                                    <div>
                                        <a th:href="@{|/board/downloadFile/${file.file_origin_name}|}"><span th:text="${file.file_origin_name}"></span></a>
                                        <label><span th:text="${file.file_size}"></span> KB</label>
                                    </div>
                                    <form>
                                        <input type="hidden" id="select_page_del" th:value="${pageMaker.criteria.page}">
                                        <input type="hidden" id="select_cntPerPage_del" th:value="${pageMaker.criteria.cntPerPage}">
                                        <button type="button" th:if="${nameUserDetails.equals(findPost.writer)}"
                                                th:attr="onclick=|attachDelete('${file.f_postno}', '${file.f_id}')|">파일삭제</button>
                                    </form>
                                </li>
                            </ul>
                        </div>
                    </div>

                    <pre><div th:text="${findPost.content}"></div></pre>
                </td>
            </tr>

            <tr>
                <td colspan="3">
                    <input type="button" value="목록" class="btn btn-outline-dark"
                           th:onclick="|location.href='@{|/board?page=${pageMaker.criteria.page}&cntPerPage=${pageMaker.criteria.cntPerPage}|}'|"
                    >

                    <span th:if="${nameUserDetails.equals(findPost.writer)}">
                        <input type="button" value="수정" class="btn btn-outline-dark"
                        th:onclick="|location.href='@{|/board/post/${findPost.postno}?page=${pageMaker.criteria.page}&cntPerPage=${pageMaker.criteria.cntPerPage}|}'|"
                        >

                        <form th:action="@{|/board/${findPost.postno}?page=${pageMaker.criteria.page}&cntPerPage=${pageMaker.criteria.cntPerPage}|}" method="post" id="delete_btn">
                            <input type="hidden" name="_method" value="delete">
                            <input type="submit" value="삭제" class="btn btn-outline-dark">
                        </form>
                    </span>
                </td>
            </tr>
        </table>

        <!--댓글 작성-->
        <div class="card-header bg-light">
            <h5 class="m-0 font-weight-bold text-secondary">Relpy</h5>
        </div>
        <div class="card">
            <form>
                <input type="hidden" id="postno" th:value="${findPost.postno}">
                <input type="hidden" id="page" th:value="${pageMaker.criteria.page}">
                <input type="hidden" id="cntPerPage" th:value="${pageMaker.criteria.cntPerPage}">
                <div class="card-body">
                    <textarea id="content_reply" class="form-control" rows="1"></textarea>
                </div>
                <div class="card-footer">
                    <button type="button" id="btn_reply_save" class="btn btn-outline-dark">등록</button>
                </div>
            </form>
        </div>
        <br>

        <!--댓글 리스트-->
        <div class="card mb-5">
            <div class="card-header">
                <h5 class="m-0 font-weight-bold text-secondary">Relpy List</h5>
            </div>
                <ul id="reply-box" class="list-group">
                    <form>
                        <li class="list-group-item" th:each="reply:${replyList}">
                            <input type="hidden" id="id_reply" th:value="${reply.id_reply}">
                            <input type="hidden" id="select_page" th:value="${pageMaker.criteria.page}">
                            <input type="hidden" id="select_cntPerPage" th:value="${pageMaker.criteria.cntPerPage}">

                            <!--댓글 수정 폼-->
                            <div th:if="${#strings.equals(flag, 'true') && id_reply == reply.id_reply}">
                                <form>
                                    <input type="hidden" id="postno_update" th:value="${findPost.postno}">
                                    <input type="hidden" id="page_update" th:value="${pageMaker.criteria.page}">
                                    <input type="hidden" id="cntPerPage_update" th:value="${pageMaker.criteria.cntPerPage}">
                                    <input type="hidden" id="id_reply_update" th:value="${reply.id_reply}">
                                    <div class="card-body">
                                        <textarea id="content_reply_update" class="form-control" rows="1">[[${reply.content_reply}]]</textarea>
                                    </div>
                                    <div class="card-footer">
                                        <button type="button" class="btn btn-outline-dark" id="btn_reply_update">수정완료</button>
                                    </div>
                                </form>
                            </div>

                            <!--댓글-->
                            <div th:unless="${#strings.equals(flag, 'true') && id_reply == reply.id_reply}" class="d-flex justify-content-between">
                                <div th:if="${reply.depth == 0}">
                                    <div>
                                        <label>작성자: <span th:text="${reply.name}"></span></label>
                                        <div th:text="${reply.content_reply}"></div>
                                    </div>
                                </div>

                                <div th:unless="${reply.depth == 0}">
                                    <div>
                                        <label>┖> 작성자: <span th:text="${reply.name}"></span></label>
                                        <div th:text="${reply.content_reply}"></div>
                                    </div>
                                </div>

                                <div>
                                    <button type="button" th:if="${reply.depth == 0}"
                                            th:onclick="|location.href='@{|/board/${reply.postno}/${reply.id_reply}?page=${pageMaker.criteria.page}&cntPerPage=${pageMaker.criteria.cntPerPage}|}'|">답글</button>
                                    <span th:if="${nameUserDetails.equals(reply.name)}">
                                        <button type="button" th:disabled="${!nameUserDetails.equals(reply.name)}"
                                                th:onclick="|location.href='@{|/board/${reply.postno}/reply/${reply.id_reply}?page=${pageMaker.criteria.page}&cntPerPage=${pageMaker.criteria.cntPerPage}|}'|">수정</button>
                                        <button type="button" th:attr="onclick=|replyDelete('${reply.postno}', '${reply.id_reply}')|"
                                                th:disabled="${!nameUserDetails.equals(reply.name)}">삭제</button>
                                    </span>
                                </div>
                            </div>

                            <!-- 답글 입력 폼 -->
                            <div th:if="${#strings.equals(flagReReply, 'true') && id_reply == reply.id_reply}">
                                <form>
                                    <input type="hidden" id="postno_rereply" th:value="${findPost.postno}">
                                    <input type="hidden" id="page_rereply" th:value="${pageMaker.criteria.page}">
                                    <input type="hidden" id="cntPerPage_rereply" th:value="${pageMaker.criteria.cntPerPage}">
                                    <input type="hidden" id="id_reply_rereply" th:value="${reply.id_reply}">
                                    <div class="card-body">
                                        <textarea id="content_reply_rereply" class="form-control" rows="1"></textarea>
                                    </div>
                                    <div class="card-footer">
                                        <button type="button" class="btn btn-outline-dark" id="btn_reply_rereply">등록</button>
                                    </div>
                                </form>
                            </div>
                        </li>
                    </form>
                </ul>
        </div>
    </div>

    <div th:insert="footer.html" id="footer"></div>

</body>
</html>